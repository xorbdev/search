{% set meta = craft.search.queryParamRulesMeta %}

{% if not craft.search.hasQueryParamRules %}
    {% redirect meta.url ~ '/new' %}
{% endif %}

{% extends meta.layout %}
{% do view.registerAssetBundle('craft\\web\\assets\\admintable\\AdminTableAsset') -%}

{% set title = 'Query Param Rules'|t('search') %}

{% block actionButton %}
    <a href="{{ url(meta.url ~ '/new') }}" class="btn submit add icon">
        {{'New Rule'|t('search')}}
    </a>
{% endblock %}

{% block content %}
    <div id="search_index_table"></div>
{% endblock %}

{% set tableData = [] %}

{% for item in items %}
	{% set tableData = tableData|merge([{
        id: item.id,
        title: item.name,
        resultUrlValue: item.resultUrlValue,
        resultUrlComparator: craft.search.comparatorOptions()[item.resultUrlComparator],
        queryParamPair: item.queryParamKey ~ ' = ' ~ item.queryParamValue,
        queryParamComparator: craft.search.comparatorOptions()[item.resultUrlComparator],
        url: url(meta.url ~ '/' ~ item.id),
    }]) %}
{% endfor %}

{% js %}
    var columns = [
        {
            name: '__slot:title',
            title: Craft.t('app', 'Name'),
        },
        {
            name: 'resultUrlValue',
            title: Craft.t('search', 'URI Value')
        },
        {
            name: 'resultUrlComparator',
            title: Craft.t('search', 'URI Comparator')
        },
        {
            name: 'queryParamPair',
            title: Craft.t('search', 'Query Param')
        },
        {
            name: 'queryParamComparator',
            title: Craft.t('search', 'Query Comparator')
        },
    ];

    new Craft.VueAdminTable({
        columns: columns,
        container: '#search_index_table',
        deleteAction: 'search/query-param-rules/delete',
        emptyMessage: Craft.t('search', 'No query param rules available.'),
        tableData: {{tableData|json_encode|raw}},
    });
{% endjs %}
